<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Cobertura</title>
    <style>
        :root { --primary: #0054a6; --success: #00b050; --danger: #c00000; }
        body { font-family: sans-serif; background: #f4f7f6; margin: 0; padding: 0; }
        .header { background: white; padding: 15px 40px; border-bottom: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .header img { height: 45px; }
        .container { max-width: 1100px; margin: 20px auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: var(--primary); color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; }
        .bg-success { background: var(--success); }
        .bg-dark { background: #333; }
        .pagination { display: flex; justify-content: center; gap: 15px; margin-top: 20px; align-items: center; }
    </style>
</head>
<body>

<header class="header">
    <img src="https://drive.google.com/thumbnail?id=1bawJf9oARBLy2itsOfA9YE8RVAFNdNef" alt="Logo">
    <h2 style="color:var(--primary); margin:0;">SISTEMA COBERTURA</h2>
    <img src="https://drive.google.com/thumbnail?id=1zh0lISfhL33lIht-Iis1TtQBEeqahnJg" alt="Logo CC">
</header>

<div class="container">
    <div id="loginPanel" style="text-align: center; padding: 40px 0;">
        <h3>Acceso Seguro</h3>
        <input id="u" type="text" placeholder="Usuario" style="width:250px; padding:10px; margin-bottom:10px;"><br>
        <input id="p" type="password" placeholder="ContraseÃ±a" style="width:250px; padding:10px; margin-bottom:20px;"><br>
        <button onclick="login()" class="btn" style="background:var(--primary); width:275px;">INGRESAR</button>
    </div>

    <div id="appPanel" class="hidden">
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input id="buscar" placeholder="ðŸ” Buscar municipio o nombre..." oninput="render()" style="flex-grow:1; padding:10px;">
            <button id="btnAdmin" onclick="toggleUsers()" class="btn" style="background:#f1c40f; color:black; display:none;">Gestionar</button>
            <button onclick="logout()" class="btn bg-dark">Salir</button>
        </div>

        <div id="panelGestion" class="hidden" style="background:#f9f9f9; padding:15px; margin-bottom:20px; border:1px solid #ddd;">
            <h4>Usuarios del Sistema</h4>
            <div id="listaU"></div>
        </div>

        <table>
            <thead><tr><th>Municipio</th><th>Nombre</th><th>Zona</th><th>Cobertura</th></tr></thead>
            <tbody id="cuerpo"></tbody>
        </table>

        <div class="pagination">
            <button onclick="cambiarPag(-1)" class="btn" style="background:var(--primary)">Anterior</button>
            <span id="pageTxt" style="font-weight:bold;">PÃ¡gina 1</span>
            <button onclick="cambiarPag(1)" class="btn" style="background:var(--primary)">Siguiente</button>
        </div>
    </div>
</div>

<script>
    const API = "https://script.google.com/macros/s/AKfycbxd05IF-5W6Xu6uiV4nWmN6fpCqkQdS8ic7hCyhi0IWZ2RpNoOZzNlNOQNzqagJCvqj1g/exec";
    let MASTER = [], USUARIOS = [], ROL = "", pag = 1;
    const limite = 10; [cite: 2026-02-09]

    window.onload = async () => {
        const res = await fetch(API);
        const data = await res.json();
        USUARIOS = data.usuarios.slice(1).map(r => ({u: r[0], p: r[1], r: r[2]}));
        MASTER = data.cobertura.slice(1).map(r => ({m: r[0], n: r[1], c: r[2], z: r[3], cob: r[4]}));
        
        const cache = localStorage.getItem("sesion_cob"); [cite: 2026-02-09]
        if(cache) login(JSON.parse(cache));
    };

    function login(cached = null) {
        const user = cached || USUARIOS.find(x => x.u == document.getElementById("u").value && x.p == document.getElementById("p").value);
        if(user) {
            ROL = user.r.toLowerCase();
            localStorage.setItem("sesion_cob", JSON.stringify(user)); [cite: 2026-02-09]
            document.getElementById("loginPanel").classList.add("hidden");
            document.getElementById("appPanel").classList.remove("hidden");
            if(ROL === 'admin') document.getElementById("btnAdmin").style.display = "block"; [cite: 2026-02-09]
            render();
        } else if(!cached) alert("Error de acceso");
    }

    function render() {
        const q = document.getElementById("buscar").value.toLowerCase();
        const filtrados = MASTER.filter(x => x.n.toLowerCase().includes(q) || x.m.toLowerCase().includes(q));
        const inicio = (pag - 1) * limite; [cite: 2026-02-09]
        const segment = filtrados.slice(inicio, inicio + limite); [cite: 2026-02-09]
        
        let html = "";
        segment.forEach(r => {
            html += `<tr><td>${r.m}</td><td><b>${r.n}</b></td><td>${r.z}</td><td>${r.cob}</td></tr>`;
        });
        document.getElementById("cuerpo").innerHTML = html;
        document.getElementById("pageTxt").innerText = `PÃ¡g ${pag}`;
    }

    function cambiarPag(v) { pag += v; render(); }
    function logout() { localStorage.removeItem("sesion_cob"); location.reload(); } [cite: 2026-02-09]

    function toggleUsers() { [cite: 2026-02-09]
        const p = document.getElementById("panelGestion");
        p.classList.toggle("hidden");
        let h = "<ul>";
        USUARIOS.forEach(u => h += `<li>${u.u} (${u.r}) <button onclick="eliminar('${u.u}')" style="color:red">x</button></li>`);
        document.getElementById("listaU").innerHTML = h + "</ul>";
    }

    async function eliminar(u) { [cite: 2026-02-09]
        if(confirm("Â¿Eliminar usuario?")) {
            await fetch(API, { method: 'POST', body: JSON.stringify({ action: 'delete', usuarioNombre: u }) });
            USUARIOS = USUARIOS.filter(x => x.u !== u);
            toggleUsers(); toggleUsers();
        }
    }
</script>
</body>
</html>
